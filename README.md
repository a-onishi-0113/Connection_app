# ポートフォリオ紹介

『Connection_app』はインスタライクの位置情報SNS型のWebアプリケーションです。

以下の情報をポストします。
・題
・コメント
・店舗住所
・位置情報
・画像


# ポートフォリオに使用した技術

#### 各バージョン

- Ruby 2.7.1
- Rails 6.0.4.1
- nuxt  2.15.8
- @nuxtjs/vuetify 1.12.1
- @nuxtjs/axios 5.13.6
- cookieparser0.1.0
- firebase 8.7.1
- firebase-admin 10.0.0
- firebase-tools 9.22.0
- universal-cookie 4.0.4
- vee-validate 3.4.14
- vue2-google-maps 0.10.7
- Docker 19.03.13
- docker-compose 1.27.4


#### フロントエンド
| 名称 | 説明 |
| ---- | ---- |
| Nuxt.js (SSR mode) | フロントエンドフレームワーク |
| Vuetify | UIコンポーネント |
| Firebase Authentication | JWTを用いたログイン・ログアウト |

- Vuetifyコンポーネントを導入することで、スマホ利用を想定したレスポンシブデザインを実現。

- Vuexストアでステート管理。

- 個人情報（パスワード）は、外部API（Firebase Authentication）に保存する仕組みで、外部APIで発行されるJWTをCookieに保存してログイン・ログアウト機能を実装しました。

- 未ログイン状態でアクセスして欲しくないページ（ /users/editなど ）へのアクセス対策には、Nuxt.jsのmiddlewareを活用することで自動的にリダイレクトするようにしました。

- ログイン状態でアクセスして欲しくないページ （ログインページ, 新規作成ページ） へのアクセスも同じくリダイレクトします。

#### バックエンド
| 名称 | 説明 |
| ---- | ---- |
| Rails (API mode) | APIサーバーとして利用 |
| PostgreSQL | データベース |

- RailsはAPIサーバーとして利用しており、フロントエンドコンテナからのリクエストに対してJSONデータを返しています。

- 画像データはActiveStorage経由でS3バケットに保存。

- その他のデータはRDSに保存。

- 個人情報（ログインパスワード）は外部API（Firebase Authentication）にのみ保存しており、バックエンド（Rails）には保存されません。

#### テストコード
| 名称 | 説明 |
| ---- | ---- |
| RSpec | model・requestのテストのみ |

#### インフラ
| 名称 | 説明 |
| ---- | ---- |
| ECS Fargate | サーバーレスな本番環境, オートスケール |
| CodePipeline | CI/CD環境 |
| RDS | 本番用DB（PostgreSQL） |
| Docker, Docker-compose | コンテナ環境 |
| Github | バージョン管理 |
| Terraform | 本番用インフラをコード管理 |

- ローカル開発環境からデプロイまで一貫してDockerを使用。

- ALBを通すことで常時SSL通信化。

- CodePipelineは、 『Sourceステージ => Testステージ => Buildステージ => Deployステージ』の順で実行され、Testステージで問題が発生した場合は当該ソースでのDeployは実行されません。

- 本番環境の環境変数については SSM で管理。『システム環境変数 => Terraform => SSM => 各AWSサービス』というフローで環境変数を受け渡しています。 

#### インフラ構成図

インフラの全体像をまとめたものがこちら。
RDSにはPostgreSQLを採用し、画像を除いたデータを保管。
画像データはS3に保管しています。

![スクリーンショット 2021-01-26 19.28.33.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/290888/4b873df7-3103-702f-2db7-273f6bd43149.png)

#### ER図

一貫性のあるテーブル名称を意識しました。

![ER_latest.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/290888/5e990b5c-9302-9d78-26f0-c3de6a09ae25.png)

# アプリの機能紹介

### 0. 機能一覧
| 機能名 | 説明 |
| ---- | ---- |
| ユーザー機能 | 新規登録、登録内容変更、アバター登録、ログイン、ログアウト、フォロー |
| つぶやき機能 | 投稿、編集、削除、画像複数枚登録 |
| つぶやきコメント機能 | つぶやきに対してコメント投稿、コメントへのリプライ投稿、削除、画像複数枚登録 |
| つぶやきいいね機能 | つぶやきをいいねできる、マイページのいいねタブにいいねしたつぶやきを一覧表示 |
| 掲示板機能 | 質問掲示板、雑談掲示板の作成、編集、削除、画像複数枚登録 |
| 掲示板コメント機能 | 掲示板に対してコメント投稿、コメントへのリプライ投稿、削除、画像複数枚登録 |
| 私物ガジェット機能 | 登録、編集、削除、画像複数枚登録 |
| フィード機能 | つぶやき新着表示、タイムライン表示、タグフィード表示 |
| タグ管理機能 | つぶやき・掲示板・私物ガジェットにはタグを登録可能、タグをタップしてタグ詳細ページを表示、タグ詳細ページではタグを含むコンテンツを表示 |
| 検索機能 | 各コンテンツを検索可能 |
| 通知機能 | つぶやきにいいね・コメント、掲示板にコメント、他ユーザーからフォローされると通知を表示 |
| 管理者モード | Godmode のトグルスイッチをONにすると、一時的に管理者権限が有効化、各コンテンツの削除メニューが表示される |
